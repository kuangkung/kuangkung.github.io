{"meta":{"title":"kuangkung","subtitle":null,"description":"My hexo blog.","author":"kuangkung","url":"kuangkung.top","root":"/"},"pages":[],"posts":[{"title":"spring+quartz 定时任务配置","slug":"spring-quartz-定时任务配置","date":"2019-03-27T01:12:02.000Z","updated":"2019-03-30T05:34:00.208Z","comments":true,"path":"2019/03/27/spring-quartz-定时任务配置/","link":"","permalink":"kuangkung.top/2019/03/27/spring-quartz-定时任务配置/","excerpt":"spring + quartz 实现定时任务前两天项目需要配置定时任务，即到期自动执行的任务，作为刚入门的小菜鸟，我花了一天时间，综合网上的例子和资料，总算是配好了这个简单的定时任务(spring + springMVC + mybatis)。 下面就记录下我配置这个定时任务的具体步骤，中间调试时也是不断报错，不过还好最后也是解决了。","text":"spring + quartz 实现定时任务前两天项目需要配置定时任务，即到期自动执行的任务，作为刚入门的小菜鸟，我花了一天时间，综合网上的例子和资料，总算是配好了这个简单的定时任务(spring + springMVC + mybatis)。 下面就记录下我配置这个定时任务的具体步骤，中间调试时也是不断报错，不过还好最后也是解决了。 目录结构 第一个文件就是 applicationContext-quartz.xml ,当然在写这个文件之前，需要在 pom.xml 文件里添加相应的依赖 父模块的 pom.xml123456789&lt;!-- Quartz 任务调度 --&gt;&lt;quartz-scheduler.version&gt;2.2.1&lt;/quartz-scheduler.version&gt;&lt;!-- Quartz 任务调度 --&gt;&lt;dependency&gt; &lt;groupId&gt;org.quartz-scheduler&lt;/groupId&gt; &lt;artifactId&gt;quartz&lt;/artifactId&gt; &lt;version&gt;$&#123;quartz-scheduler.version&#125;&lt;/version&gt;&lt;/dependency&gt; 子模块的 pom.xml12345&lt;!-- 任务调度 --&gt;&lt;dependency&gt; &lt;groupId&gt;org.quartz-scheduler&lt;/groupId&gt; &lt;artifactId&gt;quartz&lt;/artifactId&gt;&lt;/dependency&gt; 需要注意的是，这个版本号 2.2.1 和 applicationContext-quartz.xml 文件里要写的调度触发器是有关的，这个下面讲。 配置好相关依赖后，接下来正式开始写 applicationContext-quartz.xml 文件了。 applicationContext-quartz.xml12345678910111213141516171819202122232425262728293031323334&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p=\"http://www.springframework.org/schema/p\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd\"&gt; &lt;!-- 使用MethodInvokingJobDetailFactoryBean，任务可以不实现Job接口，通过targetMethod指定调用方法 --&gt; &lt;!-- 定义目标bean和bean中的方法 --&gt; &lt;bean id=\"SpringQtzJob\" class=\"com.eigpay.framework.web.webapp.task.SpringQtzJob\" /&gt; &lt;bean id=\"SpringQtzJobMethod\" class=\"org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean\" &gt; &lt;property name=\"targetObject\"&gt; &lt;ref bean=\"SpringQtzJob\"/&gt; &lt;/property&gt; &lt;property name=\"targetMethod\"&gt; &lt;!-- 要执行的方法名称 --&gt; &lt;value&gt;execute&lt;/value&gt; &lt;/property&gt; &lt;/bean&gt; &lt;!-- ========== 调度触发器 ========== --&gt; &lt;bean id=\"CronTriggerFactoryBean\" class=\"org.springframework.scheduling.quartz.CronTriggerFactoryBean\"&gt; &lt;property name=\"jobDetail\" ref=\"SpringQtzJobMethod\"&gt;&lt;/property&gt; &lt;property name=\"cronExpression\" value=\"0/5 * * * * ?\"&gt;&lt;/property&gt; &lt;/bean&gt; &lt;!-- ========== 调度工厂 ========== --&gt; &lt;bean id=\"SpringJobSchedulerFactoryBean\" class=\"org.springframework.scheduling.quartz.SchedulerFactoryBean\"&gt; &lt;property name=\"triggers\"&gt; &lt;list&gt; &lt;ref bean=\"CronTriggerFactoryBean\"/&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt;&lt;/beans&gt; 上面的调度触发器代码块，由于版本支持问题，当 quartz 版本为 2.2.1 时，需要使用 CronTriggerFactoryBean 。当 quartz 版本为 1.x (我测的是1.8.5) 时，需要使用 CronTriggerBean，否则会抛出不支持的异常。Please pay attention at this point. 配置好 applicationContext-quartz.xml 文件之后，需要在 applicationContext.xml 导入： 1&lt;import resource=\"applicationContext-quartz.xml\"/&gt; 我一开始忘了导入，就一直在奇怪为什么定时任务没启动，这个要注意。 测试类 SpringQtzJob.java1234567891011121314151617181920212223package com.eigpay.framework.web.webapp.task;import java.sql.SQLException;/** * * @author kuangcuixia * */public class SpringQtzJob &#123; private static int counter = 0; protected void execute() &#123; /*这里只是一个测试，运用的话，到这里如果成功了，基本上没什么问题了*/ long ms = System.currentTimeMillis(); System.out.print(\"(\" + counter++ + \")\"); System.out.println(\"\\t\\t\" + new Date(ms)); &#125;&#125; 运行结果如下：12345(0) Mon Nov 13 13:58:30 CST 2017(1) Mon Nov 13 13:58:35 CST 2017…………………………… 最后就是这个 cronExpression 表达式，按照自己的需求根据网上的表达式规范可以写出自己想要的定时表达式。 下面是我测试时的 cronExpression 表达式： 1&lt;property name=\"cronExpression\" value=\"0/5 * * * * ?\"&gt;&lt;/property&gt; 以上 Thanks~","categories":[],"tags":[{"name":"Java","slug":"Java","permalink":"kuangkung.top/tags/Java/"}]}]}